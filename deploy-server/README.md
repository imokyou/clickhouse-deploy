# ClickHouse Server éƒ¨ç½²æ–¹æ¡ˆ

## æ¦‚è¿°

æœ¬é¡¹ç›®æä¾›äº†ClickHouseä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ã€é…ç½®æ–‡ä»¶ã€ç›‘æ§å·¥å…·å’Œè¯¦ç»†æ–‡æ¡£ã€‚æ”¯æŒ RHEL å…¼å®¹å‘è¡Œç‰ˆå’Œ Ubuntu LTS / Debian ä¸¤ä¸ªä¸»è¦å¹³å°ã€‚

## ğŸ—ï¸ éƒ¨ç½²æ¶æ„

### å•ç‰‡å•èŠ‚ç‚¹æ¶æ„

```json
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Application   â”‚
â”‚   (åº”ç”¨å±‚)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Balancer  â”‚
â”‚   (è´Ÿè½½å‡è¡¡)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ClickHouse     â”‚
â”‚  (å•èŠ‚ç‚¹)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

- **CPU**: 4æ ¸ (æ¨è8æ ¸)
- **å†…å­˜**: 16GB (æ¨è32GB)
- **å­˜å‚¨**: 150GB NVMe SSD (æ¨è300GB)
- **ç½‘ç»œ**: 1Gbpså¸¦å®½

### è½¯ä»¶è¦æ±‚

#### æ”¯æŒçš„æ“ä½œç³»ç»Ÿ

**RHEL å…¼å®¹å‘è¡Œç‰ˆ:**
- RHEL 7.x/8.x/9.x
- CentOS 7.x/8.x
- Rocky Linux 8.x/9.x
- AlmaLinux 8.x/9.x
- Fedora 35+

**Ubuntu/Debian:**
- Ubuntu 20.04 LTS+
- Ubuntu 22.04 LTS+
- Debian 11+
- Debian 12+

#### ClickHouseç‰ˆæœ¬
- ClickHouse 23.8 æˆ–æ›´é«˜ç‰ˆæœ¬

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. ä¸‹è½½é¡¹ç›®æ–‡ä»¶
git clone <repository-url>
cd clickhouse/deploy-server

# 2. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆLinuxç¯å¢ƒï¼‰
chmod +x scripts/*.sh

# 3. æ‰§è¡Œä¸€é”®éƒ¨ç½²
sudo ./scripts/auto-deploy.sh
```

### åˆ†æ­¥éƒ¨ç½²

```bash
# 1. ç³»ç»Ÿç¯å¢ƒå‡†å¤‡
sudo ./scripts/setup-system.sh

# 2. å®‰è£…ClickHouse
sudo ./scripts/install-clickhouse.sh

# 3. é…ç½®ClickHouse
sudo ./scripts/setup-config.sh

# 4. å¯åŠ¨æœåŠ¡
sudo ./scripts/start-service.sh

# 5. å¥åº·æ£€æŸ¥
./scripts/health-check.sh
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
deploy-server/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ éƒ¨ç½²å¤§çº².md                  # éƒ¨ç½²æ–¹æ¡ˆå¤§çº²
â”œâ”€â”€ clickhouse/                  # ClickHouseé…ç½®
â”‚   â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ config.yml          # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ users.yml           # ç”¨æˆ·é…ç½®
â”‚   â”‚   â”œâ”€â”€ performance.yml     # æ€§èƒ½ä¼˜åŒ–é…ç½®
â”‚   â”‚   â”œâ”€â”€ security.yml        # å®‰å…¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ macros.yml          # å®å®šä¹‰
â”‚   â”‚   â””â”€â”€ json-optimization.yml # JSONä¼˜åŒ–é…ç½®
â”‚   â”œâ”€â”€ data/                   # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ logs/                   # æ—¥å¿—ç›®å½•
â”œâ”€â”€ scripts/                     # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ auto-deploy.sh          # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ setup-system.sh         # ç³»ç»Ÿç¯å¢ƒå‡†å¤‡
â”‚   â”œâ”€â”€ install-clickhouse.sh   # ClickHouseå®‰è£…
â”‚   â”œâ”€â”€ setup-config.sh         # é…ç½®è„šæœ¬
â”‚   â”œâ”€â”€ start-service.sh        # æœåŠ¡å¯åŠ¨
â”‚   â”œâ”€â”€ health-check.sh         # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ backup.sh               # å¤‡ä»½è„šæœ¬
â”‚   â””â”€â”€ monitor.sh              # ç›‘æ§è„šæœ¬
â””â”€â”€ docs/                       # æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ CentOSéƒ¨ç½²æ‰‹å†Œ.md       # CentOSéƒ¨ç½²æ‰‹å†Œ
    â”œâ”€â”€ è¿ç»´æ‰‹å†Œ.md             # è¿ç»´æ‰‹å†Œ
    â””â”€â”€ é…ç½®è¯´æ˜.md             # é…ç½®è¯´æ˜
```

## ğŸ”§ å¹³å°ç‰¹æ€§

### RHEL å…¼å®¹å‘è¡Œç‰ˆç‰¹æ€§
- æ”¯æŒ `yum` å’Œ `dnf` åŒ…ç®¡ç†å™¨
- è‡ªåŠ¨é…ç½® `firewall-cmd` é˜²ç«å¢™
- æ”¯æŒ SELinux å®‰å…¨ç­–ç•¥
- å…¼å®¹ systemd æœåŠ¡ç®¡ç†

### Ubuntu/Debian ç‰¹æ€§
- æ”¯æŒ `apt` åŒ…ç®¡ç†å™¨
- è‡ªåŠ¨é…ç½® `ufw` æˆ– `iptables` é˜²ç«å¢™
- æ”¯æŒ AppArmor å®‰å…¨ç­–ç•¥
- å…¼å®¹ systemd æœåŠ¡ç®¡ç†

## ğŸ“Š éƒ¨ç½²è„šæœ¬è¯´æ˜

| è„šæœ¬åç§° | åŠŸèƒ½ | æ‰§è¡Œæ—¶é—´ | å¹³å°æ”¯æŒ |
|---------|------|----------|----------|
| `auto-deploy.sh` | ä¸€é”®å®Œæˆæ‰€æœ‰éƒ¨ç½²æ­¥éª¤ | 10-15åˆ†é’Ÿ | å…¨å¹³å° |
| `setup-system.sh` | ç³»ç»Ÿç¯å¢ƒå‡†å¤‡å’Œä¼˜åŒ– | 3-5åˆ†é’Ÿ | å…¨å¹³å° |
| `install-clickhouse.sh` | å®‰è£…ClickHouseæœåŠ¡ | 2-3åˆ†é’Ÿ | å…¨å¹³å° |
| `setup-config.sh` | é…ç½®ä¼˜åŒ–å’Œå®‰å…¨è®¾ç½® | 2-3åˆ†é’Ÿ | å…¨å¹³å° |
| `start-service.sh` | å¯åŠ¨ClickHouseæœåŠ¡ | 30ç§’ | å…¨å¹³å° |
| `health-check.sh` | å¥åº·æ£€æŸ¥å’ŒéªŒè¯ | 30ç§’ | å…¨å¹³å° |
| `backup.sh` | æ•°æ®å¤‡ä»½è„šæœ¬ | æ ¹æ®æ•°æ®é‡ | å…¨å¹³å° |
| `monitor.sh` | ç›‘æ§æœåŠ¡è„šæœ¬ | æŒç»­è¿è¡Œ | å…¨å¹³å° |

## ğŸ” æ“ä½œç³»ç»Ÿæ£€æµ‹

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹æ“ä½œç³»ç»Ÿï¼š

### RHEL å…¼å®¹å‘è¡Œç‰ˆ
- é€šè¿‡ `/etc/redhat-release` æˆ– `/etc/os-release` æ£€æµ‹
- æ”¯æŒ RHELã€CentOSã€Rocky Linuxã€AlmaLinuxã€Fedora

### Ubuntu/Debian
- é€šè¿‡ `/etc/os-release` æˆ– `/etc/debian_version` æ£€æµ‹
- æ”¯æŒ Ubuntu LTSã€Debian ç¨³å®šç‰ˆ

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æ“ä½œç³»ç»Ÿä¸æ”¯æŒ**
   ```bash
   # æ£€æŸ¥æ“ä½œç³»ç»Ÿç‰ˆæœ¬
   cat /etc/os-release
   ```

2. **åŒ…ç®¡ç†å™¨é”™è¯¯**
   ```bash
   # RHEL å…¼å®¹å‘è¡Œç‰ˆ
   sudo yum clean all && sudo yum update
   
   # Ubuntu/Debian
   sudo apt update && sudo apt upgrade
   ```

3. **é˜²ç«å¢™é…ç½®**
   ```bash
   # æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
   sudo firewall-cmd --list-all  # RHEL
   sudo ufw status               # Ubuntu
   ```

4. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
   sudo systemctl status clickhouse-server
   
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   sudo journalctl -u clickhouse-server -f
   ```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **æ–‡æ¡£**: æŸ¥çœ‹ `docs/` ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£
- **æ—¥å¿—**: æ£€æŸ¥ `/var/log/clickhouse-server/` ç›®å½•
- **é…ç½®**: æŸ¥çœ‹ `/etc/clickhouse-server/` ç›®å½•
- **æ•°æ®**: æŸ¥çœ‹ `/var/lib/clickhouse/` ç›®å½•

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚ 